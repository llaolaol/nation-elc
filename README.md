# æ•…éšœè¯Šæ–­ç³»ç»Ÿ (Fault Diagnosis System)

åŸºäº n8n å·¥ä½œæµçš„å˜å‹å™¨æ•…éšœè¯Šæ–­ç³»ç»Ÿï¼Œæä¾›æ™ºèƒ½åŒ–çš„ç”µåŠ›è®¾å¤‡æ•…éšœåˆ†æå’Œè¯Šæ–­åŠŸèƒ½ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸ºç”µåŠ›å˜å‹å™¨æ•…éšœè¯Šæ–­è®¾è®¡çš„çº¯å‰ç«¯å±•ç¤ºç³»ç»Ÿï¼Œé€šè¿‡é›†æˆ n8n å·¥ä½œæµå¹³å°å®ç°åç«¯è¯Šæ–­é€»è¾‘ã€‚ç³»ç»Ÿæ”¯æŒå¤šç§æ°”ä½“åˆ†æå‚æ•°è¾“å…¥ï¼Œèƒ½å¤Ÿè¿›è¡Œæ™ºèƒ½æ•…éšœåˆ†æï¼Œå¹¶æä¾›å¯è§†åŒ–çš„æ•…éšœæ ‘é¢„è§ˆå’Œå†å²è®°å½•ç®¡ç†åŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸ”¬ **æ™ºèƒ½è¯Šæ–­**ï¼šåŸºäºæ°”ä½“åˆ†æçš„å¤šå‚æ•°æ•…éšœè¯Šæ–­
- ğŸ“Š **å¯è§†åŒ–å±•ç¤º**ï¼šECharts é©±åŠ¨çš„æ•…éšœæ ‘å¯è§†åŒ–
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šé€‚é…ä¸åŒè®¾å¤‡çš„ç°ä»£åŒ– UI ç•Œé¢
- ğŸ“ˆ **å†å²è¿½è¸ª**ï¼šå®Œæ•´çš„è¯Šæ–­å†å²è®°å½•ç®¡ç†
- ğŸ“„ **æ–‡æ¡£ç®¡ç†**ï¼šæ”¯æŒå¤šç§æ ¼å¼çš„æŠ€æœ¯æ–‡æ¡£ç®¡ç†

## æŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶
- **Vue 3** - æ¸è¿›å¼ JavaScript æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨çš„ JavaScript è¶…é›†
- **Vite** - å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·

### UI ç»„ä»¶ä¸æ ·å¼
- **Element Plus** - åŸºäº Vue 3 çš„ç»„ä»¶åº“
- **ECharts** + **vue-echarts** - æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“

### çŠ¶æ€ç®¡ç†ä¸è·¯ç”±
- **Pinia** - Vue 3 å®˜æ–¹çŠ¶æ€ç®¡ç†åº“
- **Vue Router** - Vue.js å®˜æ–¹è·¯ç”±ç®¡ç†å™¨

### æ–‡æ¡£å¤„ç†
- **PDF.js** - PDF æ–‡æ¡£è§£æå’Œå±•ç¤º
- **xlsx** - Excel æ–‡æ¡£å¤„ç†åº“

### å¼€å‘å·¥å…·
- **ESLint** - ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier** - ä»£ç æ ¼å¼åŒ–
- **TypeScript** - ç±»å‹æ£€æŸ¥

## åŠŸèƒ½æ¨¡å—

### 1. æ•…éšœå‚æ•°è¾“å…¥ä¸è¯Šæ–­
- æ”¯æŒ 7 ç§å…³é”®æ°”ä½“æµ“åº¦å‚æ•°è¾“å…¥ï¼ˆH2ã€CH4ã€C2H6ã€C2H4ã€C2H2ã€COã€CO2ï¼‰
- å®æ—¶å‚æ•°éªŒè¯å’ŒèŒƒå›´æ£€æŸ¥
- ä¸€é”®è§¦å‘è¯Šæ–­åˆ†æ
- è¯¦ç»†çš„è¯Šæ–­ç»“æœå±•ç¤º

### 2. æ•…éšœæ ‘å¯è§†åŒ–é¢„è§ˆ
- äº¤äº’å¼æ•…éšœæ ‘å›¾è¡¨å±•ç¤º
- æ”¯æŒèŠ‚ç‚¹æœç´¢å’Œç­›é€‰
- å¤šå±‚çº§èŠ‚ç‚¹å±•å¼€/æŠ˜å åŠŸèƒ½
- è‡ªå®šä¹‰èŠ‚ç‚¹æ ·å¼å’Œå¸ƒå±€

### 3. è¯Šæ–­å†å²è®°å½•ç®¡ç†
- å®Œæ•´çš„è¯Šæ–­å†å²è¿½è¸ª
- æ”¯æŒå†å²æ•°æ®å¯¼å‡º
- è¯Šæ–­ç»“æœå¯¹æ¯”åˆ†æ
- æ•°æ®ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ

### 4. æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ
- æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼ï¼ˆPDFã€Excelã€Wordã€JSONç­‰ï¼‰
- æ–‡æ¡£åœ¨çº¿é¢„è§ˆåŠŸèƒ½
- æ–‡æ¡£åˆ†ç±»å’Œæ ‡ç­¾ç®¡ç†
- æ–‡æ¡£æœç´¢å’Œç­›é€‰

## é¡¹ç›®ç»“æ„

```
fault-diagnosis-system/
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/                # é™æ€èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ components/            # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/           # é€šç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ icons/            # å›¾æ ‡ç»„ä»¶
â”‚   â”œâ”€â”€ composables/          # Vue ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ constants/            # åº”ç”¨å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ router/               # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ services/             # API æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ diagnosis.ts      # æ•…éšœè¯Šæ–­æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ mockApi.v2.ts     # æ¨¡æ‹Ÿ API æœåŠ¡
â”‚   â”‚   â””â”€â”€ visualization.ts  # å¯è§†åŒ–æœåŠ¡
â”‚   â”œâ”€â”€ stores/               # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ views/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ FaultDiagnosis.vue    # æ•…éšœè¯Šæ–­é¡µé¢
â”‚   â”‚   â”œâ”€â”€ FaultTreePreview.vue  # æ•…éšœæ ‘é¢„è§ˆé¡µé¢
â”‚   â”‚   â”œâ”€â”€ DiagnosisHistory.vue  # è¯Šæ–­å†å²é¡µé¢
â”‚   â”‚   â””â”€â”€ DocumentManagement.vue # æ–‡æ¡£ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ App.vue               # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts               # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json              # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â”œâ”€â”€ vite.config.ts            # Vite æ„å»ºé…ç½®
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## API é›†æˆè¯´æ˜

### n8n Webhook é›†æˆ

æœ¬ç³»ç»Ÿé€šè¿‡ n8n å¹³å°çš„ webhook åŠŸèƒ½å®ç°åç«¯æ•…éšœè¯Šæ–­é€»è¾‘é›†æˆã€‚

#### Webhook ç«¯ç‚¹é…ç½®

```typescript
// src/services/diagnosis.ts
const N8N_WEBHOOK_URL = 'http://3.27.250.156:5678/webhook/power-fault-diagnosis-1';
```

#### è¯·æ±‚æ ¼å¼

**HTTP æ–¹æ³•**: `POST`

**è¯·æ±‚å¤´**:
```
Content-Type: application/json
```

**è¯·æ±‚ä½“ç»“æ„**:
```typescript
// è¯·æ±‚æ•°æ®è¢«åŒ…è£…åœ¨æ•°ç»„ä¸­ï¼Œç¬¦åˆ n8n webhook çš„æœŸæœ›æ ¼å¼
[
  {
    H2_ppm: number,           // æ°¢æ°”æµ“åº¦ (ppm)
    CH4_ppm: number,          // ç”²çƒ·æµ“åº¦ (ppm)
    C2H6_ppm: number,         // ä¹™çƒ·æµ“åº¦ (ppm)
    C2H4_ppm: number,         // ä¹™çƒ¯æµ“åº¦ (ppm)
    C2H2_ppm: number,         // ä¹™ç‚”æµ“åº¦ (ppm)
    CO_ppm: number,           // ä¸€æ°§åŒ–ç¢³æµ“åº¦ (ppm)
    CO2_ppm: number,          // äºŒæ°§åŒ–ç¢³æµ“åº¦ (ppm)
    total_hydrocarbons_limit?: number, // æ€»çƒƒé˜ˆå€¼ (å¯é€‰)
    prpd_feature?: string,    // PRPD ç‰¹å¾ (å¯é€‰)
    transformer_id?: string   // å˜å‹å™¨ID (å¯é€‰)
  }
]
```

#### è¯·æ±‚ç¤ºä¾‹

```javascript
const requestData = [{
  H2_ppm: 150,
  CH4_ppm: 60,
  C2H6_ppm: 20,
  C2H4_ppm: 50,
  C2H2_ppm: 150,
  CO_ppm: 100,
  CO2_ppm: 400,
  total_hydrocarbons_limit: 150
}];

fetch('http://3.27.250.156:5678/webhook/power-fault-diagnosis-1', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(requestData)
});
```

#### å“åº”æ•°æ®ç»“æ„

**æˆåŠŸå“åº”** (HTTP 200):
```typescript
// n8n è¿”å›çš„æ•°æ®ç»“æ„ï¼ˆæ•°ç»„æ ¼å¼ï¼‰
[
  {
    // è¾“å…¥å‚æ•°å›æ˜¾
    H2_ppm: number,
    CH4_ppm: number,
    C2H6_ppm: number,
    C2H4_ppm: number,
    C2H2_ppm: number,
    CO_ppm: number,
    CO2_ppm: number,
    prpd_feature: string,
    total_hydrocarbons_limit: number,
    
    // è¯Šæ–­åˆ†æç»“æœ
    three_ratio_code_array: number[],      // ä¸‰æ¯”å€¼ç¼–ç æ•°ç»„
    three_ratio_diagnosis: string,         // ä¸‰æ¯”å€¼è¯Šæ–­ç»“æœ
    dpm_fault_code: string,               // DPM æ•…éšœä»£ç 
    characteristic_gas_diagnosis: string,  // ç‰¹å¾æ°”ä½“è¯Šæ–­
    is_discharge_fault: boolean,          // æ˜¯å¦ä¸ºæ”¾ç”µæ•…éšœ
    dpm_diagnosis_result: string,         // DPM è¯Šæ–­ç»“æœ
    dmp_diagnosis_description: string,    // DPM è¯Šæ–­æè¿°
    dpm_recommendation: string            // DPM æ¨èæªæ–½
  }
]
```

#### é”™è¯¯å¤„ç†

ç³»ç»Ÿå†…ç½®äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

```typescript
// HTTP çŠ¶æ€ç é”™è¯¯
if (!response.ok) {
  const errorBody = await response.text();
  throw new Error(`HTTP error ${response.status}: ${errorBody}`);
}

// æ•°æ®ç»“æ„éªŒè¯
if (Array.isArray(result) && result.length > 0) {
  return result[0];  // è¿”å›æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå¯¹è±¡
} else {
  console.warn('Unexpected API response structure:', result);
  return result;
}
```

#### é›†æˆç‰¹ç‚¹

1. **æ•°æ®æ ¼å¼é€‚é…**: è‡ªåŠ¨å¤„ç† n8n webhook æœŸæœ›çš„æ•°ç»„æ ¼å¼
2. **é”™è¯¯æ¢å¤**: å®Œæ•´çš„ HTTP é”™è¯¯å’Œæ•°æ®æ ¼å¼å¼‚å¸¸å¤„ç†
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
4. **å“åº”é€‚é…**: è‡ªåŠ¨è§£åŒ…æ•°ç»„å“åº”è¿”å›æ ¸å¿ƒæ•°æ®å¯¹è±¡

### æœ¬åœ°æ¨¡æ‹Ÿ API

å¼€å‘ç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿè¿˜æä¾›äº†æœ¬åœ°æ¨¡æ‹Ÿ API æœåŠ¡ (`mockApi.v2.ts`)ï¼Œæ”¯æŒï¼š

- æ™ºèƒ½è¯Šæ–­é€»è¾‘æ¨¡æ‹Ÿ
- ä¸‰æ¯”å€¼æ³•åˆ†æ
- ç‰¹å¾æ°”ä½“åˆ†æ
- DPM è¯Šæ–­æ–¹æ³•
- å®Œæ•´çš„æ•…éšœç±»å‹è¯†åˆ«

## å®‰è£…å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- **Node.js**: ^20.19.0 || >=22.12.0
- **npm**: æœ€æ–°ç¨³å®šç‰ˆæœ¬

### å®‰è£…æ­¥éª¤

1. å…‹éš†é¡¹ç›®ä»“åº“ï¼š
```bash
git clone <repository-url>
cd fault-diagnosis-system
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
npm install
```

3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
```bash
npm run dev
```

4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š
```bash
npm run build
```

### å¯ç”¨è„šæœ¬

```bash
npm run dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run preview      # é¢„è§ˆç”Ÿäº§æ„å»º
npm run type-check   # TypeScript ç±»å‹æ£€æŸ¥
npm run lint         # ESLint ä»£ç æ£€æŸ¥
npm run format       # Prettier ä»£ç æ ¼å¼åŒ–
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

é¡¹ç›®é‡‡ç”¨ ESLint + Prettier è¿›è¡Œä»£ç è´¨é‡æ§åˆ¶ï¼š

- **ESLint**: è´Ÿè´£ä»£ç è´¨é‡æ£€æŸ¥å’Œæ½œåœ¨é—®é¢˜è¯†åˆ«
- **Prettier**: è´Ÿè´£ä»£ç æ ¼å¼åŒ–å’Œé£æ ¼ç»Ÿä¸€
- **TypeScript**: æä¾›ç±»å‹å®‰å…¨å’Œå¼€å‘æ—¶é”™è¯¯æ£€æŸ¥

### æ·»åŠ æ–°çš„è¯Šæ–­æ–¹æ³•

1. åœ¨ `src/types/index.ts` ä¸­å®šä¹‰ç›¸å…³ç±»å‹æ¥å£
2. åœ¨ `src/services/diagnosis.ts` ä¸­å®ç° API è°ƒç”¨é€»è¾‘
3. åœ¨ç›¸åº”çš„ Vue ç»„ä»¶ä¸­é›†æˆæ–°çš„è¯Šæ–­æ–¹æ³•
4. æ›´æ–° `src/constants/index.ts` ä¸­çš„ç›¸å…³å¸¸é‡é…ç½®

### ç»„ä»¶å¼€å‘è§„èŒƒ

- ä½¿ç”¨ Vue 3 Composition API
- ä¼˜å…ˆä½¿ç”¨ TypeScript è¿›è¡Œç±»å‹æ ‡æ³¨
- éµå¾ª Element Plus ç»„ä»¶åº“è®¾è®¡è§„èŒƒ
- ä¿æŒç»„ä»¶çš„å•ä¸€èŒè´£åŸåˆ™

## éƒ¨ç½²å’Œé…ç½®

### ç”Ÿäº§ç¯å¢ƒæ„å»º

```bash
npm run build
```

æ„å»ºäº§ç‰©å°†ç”Ÿæˆåœ¨ `dist/` ç›®å½•ä¸­ã€‚

### ç¯å¢ƒå˜é‡

å¯ä»¥é€šè¿‡ `.env` æ–‡ä»¶é…ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# n8n webhook ç«¯ç‚¹
VITE_N8N_WEBHOOK_URL=http://your-n8n-instance:5678/webhook/your-webhook-id

# API åŸºç¡€è·¯å¾„
VITE_API_BASE_URL=http://your-api-server.com

# åº”ç”¨æ ‡é¢˜
VITE_APP_TITLE=æ•…éšœè¯Šæ–­ç³»ç»Ÿ
```

### éƒ¨ç½²é…ç½®

ç³»ç»Ÿå¯ä»¥éƒ¨ç½²åˆ°ä»»ä½•æ”¯æŒé™æ€æ–‡ä»¶æ‰˜ç®¡çš„å¹³å°ï¼Œå¦‚ï¼š

- **Nginx**: é…ç½®åå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡
- **Apache**: é…ç½®è™šæ‹Ÿä¸»æœºå’Œæ–‡ä»¶æœåŠ¡
- **CDN**: éƒ¨ç½²åˆ°äº‘æœåŠ¡å¹³å°çš„é™æ€ç«™ç‚¹æœåŠ¡

## è®¸å¯è¯

[MIT License](LICENSE)

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- GitHub Issues: [é¡¹ç›® Issues é¡µé¢]
- Email: [è”ç³»é‚®ç®±]

---

Â© 2024 æ•…éšœè¯Šæ–­ç³»ç»Ÿ. All rights reserved.